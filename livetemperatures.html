<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<!-- Map container -->
<div id="map"></div>

<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  width: 100%;
  overflow: hidden;           /* κόβει τυχόν κύλιση */
  overscroll-behavior: none;  /* αποφεύγει bounce */
}


  #map {
    position: fixed; /* pin to top-left, fill screen */
    top: 0; left: 0; right: 0; bottom: 0;
    background: #fff;
  }
</style>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
const station_names = 'https://gist.githubusercontent.com/Mariosmsk/38fa37997f2b7bcb11cbcb29e4548a45/raw/json';
const isMobileOrTablet = window.innerWidth <= 1024;

document.addEventListener("DOMContentLoaded", function () {
  const map = L.map('map', {
    crs: L.CRS.Simple,
    zoomControl: false,
    attributionControl: false,
    dragging: false,            // default no dragging
    boxZoom: false,
    doubleClickZoom: false,
    scrollWheelZoom: false,
    touchZoom: false,
    keyboard: false,
    tap: false,
    zoomSnap: 0.1,
    zoomDelta: 0.1,
    minZoom: -3.5,
    maxZoom: 3.0
  });

  map._container.style.cursor = 'default';

  // Image bounds: [ [yMin, xMin], [yMax, xMax] ]
  const imgBounds = [[0, 0], [1000, 1500]];
  const imageUrl = 'https://www.dropbox.com/scl/fi/uo3dac9ojbfui6886tgl6/livetemperatures.png?rlkey=w43k4nuwfxxd4i9x4bo3pcpwd&raw=1';

  L.imageOverlay(imageUrl, imgBounds).addTo(map);

  // Fit image into view with padding
  map.fitBounds(imgBounds, { padding: [18, 18] });

  // Zoom tweak for mobile
  if (isMobileOrTablet) {
    const fitZ = map.getZoom();     
    map.setZoom(fitZ + 0.3);   // μικρό boost, άλλαξέ το (0, 0.2, 0.3) αν χρειάζεται
    map.dragging.enable();     // δίνουμε δυνατότητα dragging στο κινητό
    map.touchZoom.disable();   // αλλά όχι pinch-zoom
    map.scrollWheelZoom.disable();
  }

  // Lock map inside image bounds
  map.setMaxBounds(imgBounds);

  // --- Station popups ---
  fetch(station_names)
    .then(r => {
      if (!r.ok) throw new Error(`HTTP error! Status: ${r.status}`);
      return r.json();
    })
    .then(data => {
      const temperatureData = data.stations.map(s => ({
        lat: s.lat,
        lng: s.lng,
        content: s.name
      }));

      temperatureData.forEach(d => {
        const popup = L.popup({ closeButton: true })
          .setLatLng([d.lat, d.lng])
          .setContent('<div class="custom-popup">' + d.content + '</div>');

        const clickableArea = L.circle([d.lat, d.lng], {
          radius: 10,
          opacity: 0,
          fillOpacity: 0
        }).addTo(map);

        clickableArea.on('mouseover', function () {
          map._container.style.cursor = 'pointer';
        });
        clickableArea.on('mouseout', function () {
          map._container.style.cursor = 'default';
        });
        clickableArea.on('click', function () {
          popup.openOn(map);
        });
      });

      window.addEventListener('resize', function () {
        map.invalidateSize();
      });
    })
    .catch(err => console.error('Error fetching the JSON data:', err));

  // Popup styles
  const style = document.createElement('style');
  style.innerHTML = `
    .custom-popup {
      border-radius: 10px;
      border: 1px solid #ccc;
      background: #fff;
      padding: 5px;
      font-weight: bold;
      font-size: 12px;
      text-align: center;
    }
    .leaflet-popup-content {
      margin: 6px !important;
      padding: 8px !important;
    }
  `;
  document.head.appendChild(style);
});
</script>
